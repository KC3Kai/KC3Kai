// Paste result table of following TsunDB query with updated the event id:
/*
select distinct fleet#>>'{voice,0}' as voiceids, fleet#>>'{voice,1}' as voiceorders, fleet->>'ship' as ships from friendlyfleet where map like '61-%'
*/
const rawtbl = `
[144,157,161,161]	[1,2,0,0]	[662,981,983,688]
[148,154,154,161,161]	[1,2,3,0,0]	[639,887,719,976,977]
[148,158,161,161]	[1,2,0,0]	[639,977,976,436]
[149,261,161,161]	[1,2,0,0]	[393,741,893,394]
[151,149,161]	[1,2,0]	[705,394,893]
[151,159]	[1,2]	[705,906]
[151,160]	[1,2]	[372,970]
[151,160,161]	[1,2,0]	[372,970,967]
[151,259]	[1,2]	[372,967]
[153,147,161]	[1,2,0]	[713,893,394]
[155,155,161,161,161]	[1,2,0,3,0]	[196,197,321,330,346]
[155,156,156,161,161]	[1,2,3,0,0]	[723,930,928,629,726]
[155,160,161,161]	[1,2,0,0]	[723,734,726,629]
[155,161,161,161]	[1,2,0,0]	[938,1010,726,737]
[156,148,161,161]	[1,2,0,0]	[640,607,374,375]
[156,161]	[1,0]	[726,689]
[156,161,161]	[1,2,0]	[640,374,375]
[157,161]	[1,2]	[193,321]
[157,161,161]	[1,2,0]	[981,983,688]
[157,161,161,161,161]	[1,2,3,0,0]	[193,321,736,742,997]
[158,156,161,161]	[1,2,0,0]	[930,928,726,689]
[158,158,161]	[1,2,0]	[949,977,436]
[158,158,161]	[1,2,0]	[949,977,976]
[158,158,161,161]	[1,2,0,0]	[949,977,976,436]
[158,160,161,161]	[1,2,0,0]	[930,734,726,689]
[159,155,142,161,161]	[1,2,3,0,0]	[969,724,372,970,967]
[159,155,161,259]	[1,2,0,3]	[969,724,372,967]
[159,160,161]	[1,2,0]	[724,970,967]
[159,160,161]	[1,2,0]	[734,726,629]
[159,160,161]	[1,2,0]	[734,726,689]
[159,160,161]	[1,2,0]	[969,970,967]
[159,161]	[1,0]	[630,705]
[161,144,153,161,161,161]	[1,2,3,0,0,0]	[546,662,981,688,118,119]
[161,156,156,161,161]	[1,2,3,0,0]	[741,930,928,629,726]
[161,157,153,161,161]	[1,2,3,0,0]	[546,955,981,688,118]
[161,161]	[1,0]	[977,976]
[161,161]	[1,2]	[738,739]
[161,161,161]	[1,2,0]	[738,739,630]
[161,161,161]	[1,2,0]	[738,739,906]
[161,161,251,161]	[1,2,3,0]	[738,739,705,906]
[161,161,251,161,161]	[1,2,3,0,0]	[738,739,705,906,394]
[161,255,156,161,161,161]	[1,2,3,0,0,0]	[741,723,930,928,629,726]
[161,259]	[1,2]	[970,967]
[244,150,161,161]	[1,2,0,0]	[464,578,736,742]
[244,157,161,161]	[1,2,0,0]	[464,193,321,578]
[244,157,161,161,157]	[1,2,0,0,3]	[464,193,321,578,955]
[248,255,161,161,161]	[1,2,0,0,0]	[697,938,1010,726,737]
[255,255,161,161]	[1,2,0,0]	[197,196,330,346]
[256,160]	[1,2]	[928,734]
[256,160,161]	[1,2,0]	[928,734,737]
[257,161]	[1,2]	[955,997]
[257,161,161]	[1,2,0]	[955,997,736]
[261,150,161]	[1,2,0]	[321,578,955]
[261,157]	[1,2]	[997,955]
[261,157,161,161]	[1,2,0,0]	[321,955,578,997]
[261,161]	[1,0]	[330,346]
[261,161]	[1,0]	[330,968]
[261,161,161]	[1,2,0]	[321,330,346]
[261,161,161]	[1,2,0]	[330,346,968]
[261,161,161]	[1,2,0]	[736,997,742]
[261,261]	[1,2]	[739,738]
[261,261,161]	[1,2,0]	[739,738,630]
[261,261,161]	[1,2,0]	[739,738,705]
[261,261,161]	[1,2,0]	[739,738,906]
[261,261,161,161]	[1,2,0,0]	[739,738,705,906]
[261,261,161,161]	[1,2,0,0]	[739,738,893,394]
`


const ffv = rawtbl.split(/\n/).filter(s => !!s.trim())
	.map(ln => ln.trim().split(/\t/).map(a => JSON.parse(a)))
console.info('FF voice parsed records:', ffv.length)
//console.debug(ffv)


const voiceByShipId = {}
ffv.forEach(r => {
	r[0].forEach((voiceId, i) => {
		const voiceRecord = voiceByShipId[voiceId] || []
		if(!voiceRecord.length) voiceByShipId[voiceId] = voiceRecord
		const speakOrder = r[1][i], shipId = r[2][i] || -1
		if(speakOrder > 0 && !voiceRecord.includes(shipId)) voiceRecord.push(shipId)
	})
})
const distinctShip = new Set()
Object.keys(voiceByShipId).forEach(s => {
	voiceByShipId[s] = voiceByShipId[s].sort((a, b) => a - b)
	voiceByShipId[s].forEach(id => distinctShip.add(id))
})
//console.debug(distinctShip)
console.info('FF voice-ship stats:', Object.keys(voiceByShipId).length,
	'voices from', distinctShip.size, 'ships:')
console.info(JSON.stringify(voiceByShipId))


// Update id list respectively
const voicesLookfor = [161, 261]
const previousFound = [321,738,739,741,970,997, 330,346,374,546,736,977,983,1010]
voicesLookfor.forEach(v => {
	console.info(`voice-${v} ${voiceByShipId[v].length} ships:`, voiceByShipId[v].join(','))
	console.info(`voice-${v} new ships:`, voiceByShipId[v].filter(id => !previousFound.includes(id)).join(','))
})


// To get available voice id list (to determine if 3xx exists?):
/*
select distinct voiceid from (
  select distinct (fleet#>>'{voice,0}')::jsonb as voiceids from friendlyfleet where map like '61-%'
) as t, jsonb_array_elements(t.voiceids) as voiceid order by voiceid
*/
